<!DOCTYPE HTML>
<html>
	<head>
		<title>Reset Password Form  Responsive Widget Template | Home :: w3layouts</title>
		<!-- Custom Theme files -->
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

		<!--JQuery-->
		<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

		<!--google fonts-->
		<link href='//fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900' rel='stylesheet' type='text/css'>

		<!--Font awesome && Bootstrap-->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

		<!-- Loading mask -->
		<script type="text/javascript">
			(function(a){a.fn.mask=function(c,b){a(this).each(function(){if(b!==undefined&&b>0){var d=a(this);d.data("_mask_timeout",setTimeout(function(){a.maskElement(d,c)},b))}else{a.maskElement(a(this),c)}})};a.fn.unmask=function(){a(this).each(function(){a.unmaskElement(a(this))})};a.fn.isMasked=function(){return this.hasClass("masked")};a.maskElement=function(d,c){if(d.data("_mask_timeout")!==undefined){clearTimeout(d.data("_mask_timeout"));d.removeData("_mask_timeout")}if(d.isMasked()){a.unmaskElement(d)}if(d.css("position")=="static"){d.addClass("masked-relative")}d.addClass("masked");var e=a('<div class="loadmask"></div>');if(navigator.userAgent.toLowerCase().indexOf("msie")>-1){e.height(d.height()+parseInt(d.css("padding-top"))+parseInt(d.css("padding-bottom")));e.width(d.width()+parseInt(d.css("padding-left"))+parseInt(d.css("padding-right")))}if(navigator.userAgent.toLowerCase().indexOf("msie 6")>-1){d.find("select").addClass("masked-hidden")}d.append(e);if(c!==undefined){var b=a('<div class="loadmask-msg" style="display:none;"></div>');b.append("<div>"+c+"</div>");d.append(b);b.css("top",Math.round(d.height()/2-(b.height()-parseInt(b.css("padding-top"))-parseInt(b.css("padding-bottom")))/2)+"px");b.css("left",Math.round(d.width()/2-(b.width()-parseInt(b.css("padding-left"))-parseInt(b.css("padding-right")))/2)+"px");b.show()}};a.unmaskElement=function(b){if(b.data("_mask_timeout")!==undefined){clearTimeout(b.data("_mask_timeout"));b.removeData("_mask_timeout")}b.find(".loadmask-msg,.loadmask").remove();b.removeClass("masked");b.removeClass("masked-relative");b.find("select").removeClass("masked-hidden")}})(jQuery);
		</script>
		<style type="text/css">
			.loadmask {
		    z-index: 100;
		    position: absolute;
		    top:0;
		    left:0;
		    -moz-opacity: 0.5;
		    opacity: .50;
		    filter: alpha(opacity=50);
		    background-color: #CCC;
		    width: 100%;
		    height: 100%;
		    zoom: 1;
			}
			.loadmask-msg {
		    z-index: 20001;
		    position: absolute;
		    top: 0;
		    left: 0;
		    border:1px solid #6593cf;
		    background: #c3daf9;
		    padding:2px;
			}
			.loadmask-msg div {
		    padding:5px 10px 5px 25px;
		    background: #fbfbfb url('./loading.gif') no-repeat 5px 5px;
		    line-height: 16px;
				border:1px solid #a3bad9;
		    color:#222;
		    font:normal 11px tahoma, arial, helvetica, sans-serif;
		    cursor:wait;
			}
			.masked {
		    overflow: hidden !important;
			}
			.masked-relative {
		    position: relative !important;
			}
			.masked-hidden {
		    visibility: hidden !important;
			}
		</style>

		<style type="text/css">
		html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,dl,dt,dd,ol,nav ul,nav li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline;}
        article, aside, details, figcaption, figure,footer, header, hgroup, menu, nav, section {display: block;}
        ol,ul{list-style:none;margin:0;padding:0;}
        blockquote,q{quotes:none;}
        blockquote:before,blockquote:after,q:before,q:after{content:'';content:none;}
        table{border-collapse:collapse;border-spacing:0;}

        a{text-decoration:none;}
        .txt-rt{text-align:right;}/* text align right */
        .txt-lt{text-align:left;}/* text align left */
        .txt-center{text-align:center;}/* text align center */
        .float-rt{float:right;}/* float right */
        .float-lt{float:left;}/* float left */
        .clear{clear:both;}/* clear float */
        .pos-relative{position:relative;}/* Position Relative */
        .pos-absolute{position:absolute;}/* Position Absolute */
        .vertical-base{	vertical-align:baseline;}/* vertical align baseline */
        .vertical-top{	vertical-align:top;}/* vertical align top */
        .underline{	padding-bottom:5px;	border-bottom: 1px solid #eee; margin:0 0 20px 0;}/* Add 5px bottom padding and a underline */
        nav.vertical ul li{	display:block;}/* vertical menu */
        nav.horizontal ul li{	display: inline-block;}/* horizontal menu */
        img{max-width:100%;}

        body{
           font-size: 100%;
           background:#007F1B;
           font-family: 'Roboto', sans-serif;
        }
        a {
          text-decoration: none;
        }
        a:hover {
            transition: 0.5s all;
            -webkit-transition: 0.5s all;
            -moz-transition: 0.5s all;
            -o-transition: 0.5s all;
        }
        /*--elemt style strat here--*/
        .element-main {
            width:27%;
            background: #fff;
            margin:4em auto 0em;
            border-radius: 5px;
            padding:3em 2em;
        }
        .element-main h1 {
            text-align: center;
            font-size: 2.3em;
            color:#007F1B;
            font-weight: 700;
        }
        .element-main p {
            font-size: 1em;
            color: #696969;
            margin: 1.2em 0em;
            text-align:center;
        }
        .element-main input[type="password"] {
            font-size: 1em;
            color: #A29E9E;
            padding: 1em 0.5em;
            display: block;
            width: 90%;
            outline: none;
            margin-bottom: 1em;
            text-align:center;
            border: 1px solid #B9B9B9;
        }
        .element-main input[type="button"] {
            font-size: 1em;
            color: #fff;
            background:#007F1B;
            width: 50%;
            padding: 0.8em 0em;
            outline: none;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: block;
            margin: 1.5em auto 0;
        }
        .element-main input[type="button"]:hover{
            background:#006616;
            border-bottom: 3px solid #006616;
            transition: 0.5s all;
            -webkit-transition: 0.5s all;
            -moz-transition: 0.5s all;
            -o-transition: 0.5s all;
        }
        p:nth-child(0) {
        	text-align: left;
        }
        p:nth-child(1){
        	float: left;
        }
        #password {
        	float: left;
        }
        .fa {
        	float: right;
            margin-top: 3%;
            font-size: 20px;
            cursor: pointer;
        }
        .disable-btn {
            background: lightgray !important;
            cursor: default !important;
            border-bottom: 0px !important;
        }
        .popover-content {
        	text-align: jsutify !important;
        	padding: 9px 30px !important;
        }
        .popover-content ul {
        	list-style: circle !important;
        }
        /*---copyrights--*/
        .copy-right {
            margin: 9em 0em 2em 0em;
        }
        .copy-right p {
            text-align: center;
            font-size:1em;
            color:#fff;
            line-height: 1.5em;
            float: none;
        }
        .copy-right p a{
          color:#fff;
        }
        .copy-right p a:hover{
    	   color:#000;
           transition: 0.5s all;
           -webkit-transition: 0.5s all;
           -moz-transition: 0.5s all;
           -o-transition: 0.5s all;
        }
        /*--element end here--*/
        /*--media quiries start here--*/
        @media(max-width:1440px){

        }
        @media(max-width:1366px){

        }
        @media(max-width:1280px){
        .copy-right {
            margin: 6em 0em 2em 0em;
        }
        .element-main {
            width: 30%;
        }
        }
        @media(max-width:1024px){
        .element-main {
            width: 37%;
        }
        }
        @media(max-width:768px){
        .element-main {
            width: 49%;
        }
        .element-main {
            width: 60%;
        }
        .element-main h1 {
            font-size: 2em;
        }
        }
        @media(max-width:640px){

        }
        @media(max-width:480px){
        .element-main {
            width: 80%;
            padding: 3em 1.5em;
        }
        .copy-right {
            margin: 5em 0em 2em 0em;
        }
        .copy-right p {
            font-size: 0.9em;
        }
        }
        @media(max-width:320px){
        .element-main h1 {
            font-size: 1.5em;
        }
        .element-main {
            width: 80%;
            margin: 2em auto 0em;
            padding: 1.5em 1.5em;
        }
        .element-main p {
            font-size: 0.9em;
        }
        .element-main input[type="button"] {
            font-size:0.9em;
            width: 75%;
        }
        .element-main input[type="password"] {
            font-size: 0.9em;
            padding: 0.8em 0.5em;
        }
        .copy-right {
            margin: 3em 0em 2em 0em;
        }
        .copy-right p {
            font-size: 0.85em;
        	padding:0 4px;
        }
        }
        /*--media quiries end here--*/
		</style>

		<script type="text/javascript">

			$(document).ready(function(){
				$('[data-toggle="popover"]').popover();
			});

			function getUrlVars() {
			    var vars = [], hash;
			    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
			    for(var i = 0; i < hashes.length; i++)
			    {
			        hash = hashes[i].split('=');
			        vars.push(hash[0]);
			        vars[hash[0]] = hash[1];
			    }
			    return vars;
			}

			var key = getUrlVars()["key"];

			function isValidPassword(password){
				var isValid = password.match(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[0-9a-zA-Z]{8,}$/);
				if (isValid === null) return false;
				else return true;
			}

			function resetPassword(){
				$('#reset-password-form').mask('Enviando...');

				var password = $('#password').val(),
					repeatPassword = $('#repeatPassword').val();

				if ($('#alert-success').is(':visible')) $('#alert-success').hide();
				if ($('#alert-error').is(':visible')) $('#alert-error').hide();

				if (password.length ===0 || repeatPassword.length === 0) {
					$('#alert-error').show();
					$('#alert-error span').text(' Ambos campos son obligatorios');
					$('#reset-password-form').unmask();
				}
				else if (password !== repeatPassword) {
					$('#alert-error').show();
					$('#alert-error span').text(' Las contraseñas no coinciden');
					$('#reset-password-form').unmask();
				} else if (!isValidPassword(password)) {
					$('#alert-error').show();
					$('#alert-error span').text(' Las contraseña introducida no es válida');
					$('#reset-password-form').unmask();
				} else if (!key) {
					$('#alert-error').show();
					$('#alert-error span').text(' La key para el reset de la password es inválida');
					$('#reset-password-form').unmask();
				}
				else {
					$.ajax({
                        url: 'http://'+window.location.host+':10000/api/users/resetPassword',
                        type: 'POST',
                        data: {
                            'key': key,
                            'password': password
    				    },
    				    success: function(data) {
    					    $('#alert-success').show();
    						$('#alert-success span').text(' La contraseña ha sido cambiada correctamente');
                            document.getElementById('reset-password-form').reset();
                            $('#resetBtn').prop('disabled', true);
                            $('#resetBtn').addClass('disable-btn');
    						$('#reset-password-form').unmask();
    					},
    					error: function(error) {
    					  	if (error.status === 0) {
    					  		$('#alert-error').show();
    							$('#alert-error span').text(' Error de conexión al intentar cambiar la contraseña');
    					  	} else {
                                var errorDetails = JSON.parse(error.responseText),
                                    errMsg = '';

				if (errorDetails.error && typeof(errorDetails.error.name)==='undefined'){
					errMsg = errorDetails.error.message;
				}
				else {
					switch(errorDetails.error.name){
	                                    case 'KEY_NOT_FOUND':{
        	                                errMsg = 'La key para el reset de la password no existe';
	                                        break;
	                                    }
	                                    case 'KEY_ALREADY_USED':{
	                                        errMsg = 'La key para el reset de la password ya ha sido usada y no es válida';
	                                        break;
	                                    }
	                                    case 'KEY_EXPIRED':{
	                                        errMsg = 'La key para el reset de la password ha expirado y no es válida';
	                                        break;
	                                    }
	                                    case 'USER_NOT_FOUND':{
	                                        errMsg = 'El usuario para el que se intenta cambiar la contraseña no existe';
	                                        break;
	                                    }
	                                    default:{
	                                        errMsg = 'Error de conexión al intentar cambiar la contraseña';
	                                    }
	                                }
				}
                                $('#alert-error').show();
                                $('#alert-error span').text(' ' + errMsg);
                            }
    						$('#reset-password-form').unmask();
    					}
				    });
				}
			}
		</script>
	</head>
	<body>
		<div class="alert alert-success alert-dismissable fade in" id='alert-success'>
		  <strong>Success!</strong><span>Indicates a successful or positive action.</span>
		</div>
		<div class="alert alert-danger alert-dismissablee fade in" id='alert-error'>
		  <strong>Error!</strong><span>Indicates an error.</span>
		</div>
		<div class="elelment">
			<div class="element-main">
				<h1>Reset Password</h1>
				<form autocomplete="off" id='reset-password-form'>
					<div>
						<p>Por favor introduce tu nueva contraseña.</p>
						<input type="password" id="password" autofocus required>
						<i class="fa fa-question-circle" aria-hidden="true"
							data-toggle="popover" data-placement="bottom" data-html="true"
                            title="Requisitos de la contraseña"
							data-content="<ul><li>Debe tener una longitud mínima de 8 caracteres.</li>
								<li>Debe contener al menos una mayúscula, una minúscula y un número</li></ul>"></i>
					</div>
					<div>
						<p>Por favor repite la contraseña.</p>
						<input type="password" id="repeatPassword" required>
						<input type="button" value="Reset" id="resetBtn" onclick="resetPassword()">
					</div>
				</form>
			</div>
		</div>
		<div class="copy-right">
			<p>© 2017 Hattrick. All rights reserved</p>
		</div>
	</body>

	<script type="text/javascript">
		$('#alert-success').hide();
		$('#alert-error').hide();
	</script>
</html>
